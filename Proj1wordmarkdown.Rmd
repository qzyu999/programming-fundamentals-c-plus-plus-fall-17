---
title: "Proj1markdown"
author: "Jared Yu"
date: "November 13, 2017"
output: word_document
---
```{r}
#set working directory to where the file can be found
setwd("C:/Users/jyqq9/Desktop/STA 108/Project 1")

#read the data file and place in a variable
mydata = read.table("UN.txt", header = T) #header=F if no first row.

#Display some of the data
head(mydata)

#Display all of the data
mydata

#Set x and y to mydata's height and weight
x=mydata$PPgdp
y=mydata$Fertility

#Display some of the data for mydata
str(x)
str(y)
str(mydata)

#1
#plot x and y, label the axes
plot(x,y,xlab="PPgdp",ylab="Fertility",main="Fertility vs. PPgdp")

#2
#create variables for the log transformations
xlog = 1/log(x)

plot(xlog, y, xlab="1/logx",ylab="y")

#3a
#xbar and ybar
ybar=mean(y)
xbar=mean(xlog)

#n, the number of variables
n=length(x)

#betahat1 and betahat0
betahat1=sum((xlog-xbar)*(y-ybar))/sum((xlog-xbar)^2)
betahat0=ybar-betahat1*xbar
betahat0
betahat1

#plot a straight line for the data using slope and intercept
abline(a = betahat0, b = betahat1)

#yhat
yhat = betahat0+betahat1*xlog

#SSR
SSR = sum((yhat-ybar)^2)

#SSE
SSE = sum((y-yhat)^2)

#SSTO
SSTO = sum((y-ybar)^2)

#R^2 and rsquared
R2 = SSR/SSTO
R2
rsquared = (1 - SSE/SSTO)
rsquared

#3b
#lm function
model = lm(y~xlog)
summary(model)

plot(xlog,y)
#plot fitted line
abline(model$coefficients)

#3c
#matrix manipulation
head(mydata)
X=as.matrix(cbind(rep(1,n),1/log(mydata[,3])))
View(X)
str(X)

XTX = t(X)%*%X
XTXinv = solve(XTX)
Y = as.matrix(mydata[,2])
View(Y)
XTY = t(X)%*%Y
betahatMatrix = XTXinv%*%XTY
betahatMatrix

plot(xlog,y)
#draw fitted matrix line
abline(betahatMatrix)

Yhat = X%*%betahatMatrix
head(Yhat)

res = as.vector(Y - Yhat)
head(res)
SSE = res%*%res

SSTO = sum((Y-mean(Y))^2)

Rsquaredmatrix = 1 - SSE/SSTO
Rsquaredmatrix

#4
model = lm(y~xlog)
plot(model, which=1)
#The dispersion of the residuals seem to be smaller at first, but they spread out as
#fitted values increase. At the end they shrink again, but the change is not severe.
stdres=rstandard(model)
hist(stdres)
#The histogram appears unimodal, with the standard deviation of residuals
#going to -3 and 3. 
qqnorm(stdres)
qqline(stdres)
#The QQ plot lies mostly along the line, so there is a mostly normal distribution.

#5
#test whether beta1 = 0 at 0.05 significance level
#H0: b1 = 0 v.s. H1: b1 =/= 0
#T.S. t* = (b1hat - 0)/SE(b1hat)
summary(model)
#for the lm model, the slope has a p-value of < 2*10^-16, therefore the conclusion
#is to reject the null hypothesis

#6
MSE = summary(model)$sigma^2
Xh = 1/log(20000)
Yh=betahat0+betahat1*Xh
Yh+c(-1,1)*qt((1-0.01/2),n-2)*sqrt(MSE*(1/n + ((Xh-mean(xlog))^2)/sum((xlog-mean(xlog))^2)))
#1.438266 2.038231

#7
xseq = seq(min(mydata[,3]), max(mydata[,3]), 0.1)
xlogseq = 1/log(xseq)
W = sqrt(2*qf(1-0.05, 2, n-2))
yseq=betahat0+betahat1*xlogseq
se.y.seq = sqrt(MSE*(1/n + ((xlogseq-mean(xlog))^2)/sum((xlog-mean(xlog))^2)))
low = yseq - W*se.y.seq
high = yseq + W*se.y.seq

plot(xlog, y)
abline(betahat0,betahat1)
lines(xlogseq,low, col="red")
lines(xlogseq,high, col="blue")

#8
MSE = summary(model)$sigma^2
Xh = 1/log(25000)
Yh=betahat0+betahat1*Xh
Yh+c(-1,1)*qt((1-0.01/2),n-2)*sqrt(MSE*(1/n + 1 + ((Xh-mean(xlog))^2)/sum((xlog-mean(xlog))^2)))
#-1.057710  4.344765
```

